#!/bin/bash

set -e
. /usr/local/opt/nvm/nvm.sh
. /usr/local/share/chruby/chruby.sh


function node-client() {
  local version="$1"

  cd .code/node/websocket
  nvm use "$version"
  node examples/autobahn_client.js
  cd -
}

for v in 0.8 0.10 0.12 {4..14} ; do
  node-client "$v"
done


function ruby-client() {
  local version="$1"

  cd ".code/ruby/$version/websocket"
  chruby "$version"
  compile-driver
  ruby examples/autobahn_client.rb
  cd ../../../..
}

function compile-driver() {
  cd ../driver
  ruby -S bundle exec rake compile
  cd -
}

for v in 1.9.3 2.0.0 2.1.10 2.2.10 2.3.8 2.4.10 2.5.8 2.6.6 2.7.1 ; do
  ruby-client "$v"
done

cd .code/ruby/jruby-1.7/websocket
chruby jruby-1.7
compile-driver
ruby -J-Xmx2048m --1.9 examples/autobahn_client.rb
ruby -J-Xmx2048m --2.0 examples/autobahn_client.rb
cd ../../../..
